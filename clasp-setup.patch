*** Begin Patch
*** Add File: scripts/google-script/.clasp.json
+{
+  "scriptId": "1UVySsPaTvScSIBQduY4FVZWAz4ugNq_1cdN6Kng86DAayefLtmKJ0OsS",
+  "rootDir": "src"
+}

*** Add File: scripts/google-script/appsscript.json
+{
+  "timeZone": "America/Santiago",
+  "exceptionLogging": "STACKDRIVER",
+  "runtimeVersion": "V8",
+  "oauthScopes": [
+    "https://www.googleapis.com/auth/script.external_request",
+    "https://www.googleapis.com/auth/script.send_mail",
+    "https://www.googleapis.com/auth/calendar",
+    "https://www.googleapis.com/auth/calendar.events",
+    "https://www.googleapis.com/auth/spreadsheets",
+    "https://www.googleapis.com/auth/userinfo.email"
+  ]
+}

*** Add File: scripts/google-script/src/Code.gs
+/**
+ * WebApp de reservas ‚Äî Vanessa Nails Studio
+ * Edita y despliega con clasp sin cambiar la URL del WebApp.
+ */
+
+const TZ = "America/Santiago";
+const CALENDAR_ID = "64693698ebab23975e6f5d11f9f3b170a6d11b9a19ebb459e1486314ee930ebf@group.calendar.google.com";
+const OWNER_EMAIL = "nailsvanessacl@gmail.com";
+const SHEET_ID   = "1aE4dnWZQjEJWAMaDEfDRpACVUDU8_F9-fzd_2mSQQeM";
+const SHEET_NAME = "Reservas";
+const WHATSAPP_PHONE = "56991744464";
+const BANK_LINES = [
+  "VANESSA MORALES ‚Äî Cuenta RUT 27774310-8 ‚Äî Banco Estado",
+  "VANESSA MORALES ‚Äî Cuenta Corriente 12700182876 ‚Äî Banco Estado"
+];
+const BUSINESS_HOURS = { start: "10:00", end: "18:00" };
+const DISABLED_DAYS = [
+  // Ejemplos: "SAT1", "SAT3", "SUN2"
+];
+
+const SERVICE_MAP = {
+  "1": { name: "Retoque (Mantenimiento)", duration: 120 },
+  "2": { name: "Reconstrucci√≥n U√±as Mordidas (Onicofag√≠a)", duration: 180 },
+  "3": { name: "U√±as Acr√≠licas", duration: 180 },
+  "4": { name: "U√±as Polygel", duration: 180 },
+  "5": { name: "U√±as Softgel", duration: 180 },
+  "6": { name: "Kapping o Ba√±o Polygel o Acr√≠lico sobre u√±a natural", duration: 150 },
+  "7": { name: "Reforzamiento Nivelaci√≥n Rubber", duration: 150 },
+  "8": { name: "Esmaltado Permanente", duration: 90 }
+};
+
+function buildRfc3339(dateStr, timeStr, minutesToAdd) {
+  if (!dateStr || !timeStr) throw new Error("dateStr/timeStr requeridos");
+  const [Y, M, D] = dateStr.split("-").map(Number);
+  const [h, m]   = timeStr.split(":").map(Number);
+  const start = new Date(Y, M - 1, D, h, m, 0, 0);
+  const end   = new Date(start.getTime() + (Number(minutesToAdd) || 0) * 60000);
+  const startStr = Utilities.formatDate(start, TZ, "yyyy-MM-dd'T'HH:mm:ssXXX");
+  const endStr   = Utilities.formatDate(end,   TZ, "yyyy-MM-dd'T'HH:mm:ssXXX");
+  return { start, end, startStr, endStr };
+}
+
+function isDisabledDay(date) {
+  const dow = date.getDay(); // 0 dom, 6 s√°b
+  const weekNum = Math.ceil(date.getDate() / 7);
+  if (dow === 6) return DISABLED_DAYS.includes("SAT" + weekNum);
+  if (dow === 0) return DISABLED_DAYS.includes("SUN" + weekNum);
+  return false;
+}
+
+function hasConflictCalendarApp(calendarId, start, end) {
+  const cal = CalendarApp.getCalendarById(calendarId);
+  const events = cal.getEvents(start, end);
+  return events && events.length > 0;
+}
+
+function appendToSheet(row) {
+  const ss = SpreadsheetApp.openById(SHEET_ID);
+  const sh = ss.getSheetByName(SHEET_NAME) || ss.insertSheet(SHEET_NAME);
+  sh.appendRow(row);
+}
+
+function buildEmailHtml({ clientName, fecha, hora, duracion, telefono, serviceName, htmlLink }) {
+  const bankList = BANK_LINES.map(l => `<li>${l}</li>`).join("");
+  const whatsLink = `https://wa.me/${WHATSAPP_PHONE}?text=${encodeURIComponent(
+    "Hola Vanessa, te env√≠o el comprobante de reserva. Mi nombre es " + clientName
+  )}`;
+  return `
+  <div style="font-family:Arial,sans-serif;color:#333;line-height:1.6">
+    <div style="max-width:560px;margin:auto;border:1px solid #f2d7e2;border-radius:12px;overflow:hidden">
+      <div style="background:#fef0f5;padding:16px 20px">
+        <h2 style="margin:0;color:#d63384">‚ú® Confirmaci√≥n de Reserva</h2>
+      </div>
+      <div style="padding:20px">
+        <p>Hola <b>${clientName}</b>, tu cita ha sido registrada con √©xito üíÖüèª</p>
+        <table style="width:100%;border-collapse:collapse;font-size:14px;margin:12px 0">
+          <tr><td style="padding:6px 0;width:140px"><b>Servicio:</b></td><td>${serviceName || "-"}</td></tr>
+          <tr><td style="padding:6px 0"><b>Fecha:</b></td><td>${fecha}</td></tr>
+          <tr><td style="padding:6px 0"><b>Hora:</b></td><td>${hora}</td></tr>
+          <tr><td style="padding:6px 0"><b>Duraci√≥n:</b></td><td>${duracion} minutos</td></tr>
+          <tr><td style="padding:6px 0"><b>Tel√©fono:</b></td><td>${telefono || "-"}</td></tr>
+          ${htmlLink ? `<tr><td style="padding:6px 0"><b>Evento:</b></td><td><a href="${htmlLink}">Abrir en Google Calendar</a></td></tr>` : ""}
+        </table>
+        <hr style="border:none;border-top:1px solid #eee;margin:16px 0">
+        <h3 style="margin:10px 0 6px">üíñ Condiciones de Reserva</h3>
+        <p>Para apartar tu horita debes enviar una reserva de <b>$5.000</b> pesos, la cual se descuenta del valor total del servicio.</p>
+        <p>üè¶ Transferir a:</p>
+        <ul style="margin:0 0 10px 18px;padding:0">${bankList}</ul>
+        <p>üíñ Por favor, env√≠a el comprobante por WhatsApp:
+          <a href="${whatsLink}" style="color:#d63384;font-weight:bold;text-decoration:none">Enviar comprobante</a>
+        </p>
+        <p>üö´ Si faltas a tu hora, no se realiza devoluci√≥n de la reserva.<br>
+           üëâ Puedes reagendar con el mismo abono notificando como m√≠nimo <b>24 horas antes</b>.</p>
+        <p style="font-size:12px;color:#666;margin-top:18px">
+          Gracias por tu preferencia üíÖüèª<br>Vanessa Nails Studio
+        </p>
+      </div>
+    </div>
+  </div>`;
+}
+
+function jsonResponse(obj) {
+  return ContentService.createTextOutput(JSON.stringify(obj))
+    .setMimeType(ContentService.MimeType.JSON);
+}
+
+function doPost(e) {
+  try {
+    if (!e || !e.postData || !e.postData.contents) {
+      return jsonResponse({ success: false, error: "Solicitud vac√≠a" });
+    }
+    let data;
+    try { data = JSON.parse(e.postData.contents); }
+    catch { return jsonResponse({ success: false, error: "JSON inv√°lido" }); }
+
+    const nombre    = (data.nombre || data.name || "").trim();
+    const email     = (data.email || "").trim();
+    const telefono  = (data.telefono || data.phone || "").trim();
+    const fecha     = (data.fecha || data.date || "").trim(); // YYYY-MM-DD
+    const hora      = (data.hora  || data.start || "").trim(); // HH:mm
+    const serviceId = String(data.serviceId || "");
+    const durationMin = Number(data.durationMin || (SERVICE_MAP[serviceId]?.duration || 60));
+    const serviceName = data.servicio || SERVICE_MAP[serviceId]?.name || "Servicio";
+
+    if (!nombre || !email || !fecha || !hora) {
+      return jsonResponse({ success: false, error: "Faltan campos: nombre, email, fecha, hora" });
+    }
+
+    const probe = new Date(`${fecha}T${hora}:00`);
+    if (isNaN(probe.getTime())) return jsonResponse({ success: false, error: "Fecha/Hora inv√°lidas" });
+    if (isDisabledDay(probe))   return jsonResponse({ success: false, error: "Este d√≠a no est√° disponible para reservas." });
+
+    const { start, end, startStr, endStr } = buildRfc3339(fecha, hora, durationMin);
+    if (hasConflictCalendarApp(CALENDAR_ID, start, end)) {
+      return jsonResponse({ success: false, error: "Horario no disponible (conflicto)" });
+    }
+
+    const cal = CalendarApp.getCalendarById(CALENDAR_ID);
+    const event = cal.createEvent(
+      `Cita: ${serviceName} con ${nombre}`,
+      start,
+      end,
+      {
+        description: [
+          `Cliente: ${nombre}`,
+          `Email: ${email}`,
+          `Tel√©fono: ${telefono}`,
+          `Servicio: ${serviceName}`,
+          `Duraci√≥n: ${durationMin} min`
+        ].join("\\n"),
+        guests: email + (OWNER_EMAIL ? "," + OWNER_EMAIL : ""),
+        sendInvites: true
+      }
+    );
+
+    const startLocal = Utilities.formatDate(start, TZ, "yyyy-MM-dd HH:mm");
+    const endLocal   = Utilities.formatDate(end,   TZ, "yyyy-MM-dd HH:mm");
+    appendToSheet([
+      new Date(), nombre, email, telefono,
+      serviceName, startLocal, endLocal, durationMin,
+      event.getId(), event.getHtmlLink()
+    ]);
+
+    const html = buildEmailHtml({
+      clientName: nombre,
+      fecha, hora, duracion: durationMin,
+      telefono, serviceName,
+      htmlLink: event.getHtmlLink()
+    });
+
+    MailApp.sendEmail({ to: email, subject: `‚úÖ Confirmaci√≥n de Reserva ‚Äî ${serviceName}`, htmlBody: html });
+    if (OWNER_EMAIL) {
+      MailApp.sendEmail({ to: OWNER_EMAIL, subject: `Nueva Cita ‚Äî ${serviceName} (${nombre})`, htmlBody: html });
+    }
+
+    return jsonResponse({ success: true, eventId: event.getId(), htmlLink: event.getHtmlLink(), start: startStr, end: endStr });
+  } catch (err) {
+    return jsonResponse({ success: false, error: String(err) });
+  }
+}
+
+function test_doPost() {
+  const e = { postData: { contents: JSON.stringify({
+    nombre: "Prueba VSCode",
+    email: "cliente@example.com",
+    telefono: "56911112222",
+    fecha: "2025-08-25",
+    hora: "10:00",
+    serviceId: 8,
+    durationMin: 90,
+    servicio: "Esmaltado Permanente"
+  })}};
+  const res = doPost(e);
+  Logger.log(res.getContent());
+}
+
*** End Patch
