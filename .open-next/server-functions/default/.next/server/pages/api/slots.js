"use strict";(()=>{var e={};e.id=643,e.ids=[643],e.modules={145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},2353:e=>{e.exports=import("luxon")},6249:(e,t)=>{Object.defineProperty(t,"l",{enumerable:!0,get:function(){return function e(t,r){return r in t?t[r]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,r)):"function"==typeof t&&"default"===r?t:void 0}}})},6171:(e,t,r)=>{r.a(e,async(e,a)=>{try{r.r(t),r.d(t,{config:()=>u,default:()=>d,routeModule:()=>c});var n=r(1802),o=r(7153),i=r(6249),s=r(3805),l=e([s]);s=(l.then?(await l)():l)[0];let d=(0,i.l)(s,"default"),u=(0,i.l)(s,"config"),c=new n.PagesAPIRouteModule({definition:{kind:o.x.PAGES_API,page:"/api/slots",pathname:"/api/slots",bundlePath:"",filename:""},userland:s});a()}catch(e){a(e)}})},3805:(e,t,r)=>{r.a(e,async(e,a)=>{try{r.r(t),r.d(t,{default:()=>i,runtime:()=>u});var n=r(2353),o=e([n]);n=(o.then?(await o)():o)[0];let l="64693698ebab23975e6f5d11f9f3b170a6d11b9a19ebb459e1486314ee930ebf@group.calendar.google.com",d="AIzaSyDqIFZZGAK6xL9ST0gTkPUZL-jmd5lElbk",u="nodejs";async function i(e){let t=new URL(e.url),r=t.searchParams.get("action"),a=t.searchParams.get("date"),o=t.searchParams.get("mode")||"normal";if("getBusySlots"!==r)return s({error:"Accion no soportada. Usa action=getBusySlots."},400);if(!l||!d)return s({error:"Faltan configuraciones de Google Calendar."},500);if(!a)return s({error:"El parametro date es obligatorio (YYYY-MM-DD)."},400);try{let e=function({date:e,timezone:t}){let r=n.DateTime.fromISO((e||"")+"T00:00",{zone:t});if(!r.isValid)throw Error("Fecha invalida");let a=r.endOf("day"),o=new URLSearchParams({key:d,timeMin:r.toUTC().toISO(),timeMax:a.toUTC().toISO(),singleEvents:"true",orderBy:"startTime",maxResults:"2500"}),i=encodeURIComponent(l||"");return"https://www.googleapis.com/calendar/v3/calendars/"+i+"/events?"+o.toString()}({date:a,timezone:"America/Santiago"}),t=await fetch(e);if(!t.ok){let e=await t.text();throw Error(`Google Calendar ${t.status}: ${e}`)}let r=((await t.json()).items||[]).filter(e=>!e.start?.date&&!e.end?.date).map(e=>({start:e.start?.dateTime,end:e.end?.dateTime}));return s({busy:r,mode:o})}catch(e){return console.error("Error en /api/slots:",e),s({error:e.message||"Error interno del servidor"},500)}}function s(e,t=200){return new Response(JSON.stringify(e),{status:t,headers:{"Content-Type":"application/json"}})}a()}catch(e){a(e)}})},7153:(e,t)=>{var r;Object.defineProperty(t,"x",{enumerable:!0,get:function(){return r}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(r||(r={}))},1802:(e,t,r)=>{e.exports=r(145)}};var t=require("../../webpack-api-runtime.js");t.C(e);var r=t(t.s=6171);module.exports=r})();