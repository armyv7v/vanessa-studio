"use strict";(()=>{var e={};e.id=643,e.ids=[643],e.modules={145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},2353:e=>{e.exports=import("luxon")},6249:(e,t)=>{Object.defineProperty(t,"l",{enumerable:!0,get:function(){return function e(t,r){return r in t?t[r]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,r)):"function"==typeof t&&"default"===r?t:void 0}}})},6171:(e,t,r)=>{r.a(e,async(e,a)=>{try{r.r(t),r.d(t,{config:()=>u,default:()=>d,routeModule:()=>c});var o=r(1802),n=r(7153),s=r(6249),i=r(3805),l=e([i]);i=(l.then?(await l)():l)[0];let d=(0,s.l)(i,"default"),u=(0,s.l)(i,"config"),c=new o.PagesAPIRouteModule({definition:{kind:n.x.PAGES_API,page:"/api/slots",pathname:"/api/slots",bundlePath:"",filename:""},userland:i});a()}catch(e){a(e)}})},3805:(e,t,r)=>{r.a(e,async(e,a)=>{try{r.r(t),r.d(t,{default:()=>s});var o=r(2353),n=e([o]);o=(n.then?(await n)():n)[0];let i="64693698ebab23975e6f5d11f9f3b170a6d11b9a19ebb459e1486314ee930ebf@group.calendar.google.com",l="AIzaSyDqIFZZGAK6xL9ST0gTkPUZL-jmd5lElbk";async function s(e,t){let{action:r,date:a,mode:n="normal"}=e.query;if("getBusySlots"!==r)return t.status(400).json({error:"Acci\xf3n no soportada. Usa action=getBusySlots."});if(!i||!l)return t.status(500).json({error:"Faltan configuraciones de Google Calendar."});if(!a)return t.status(400).json({error:"El par\xe1metro date es obligatorio (YYYY-MM-DD)."});try{let e=function({date:e,timezone:t}){let r=o.DateTime.fromISO((e||"")+"T00:00",{zone:t});if(!r.isValid)throw Error("Fecha inv\xe1lida");let a=r.endOf("day"),n=new URLSearchParams({key:l,timeMin:r.toUTC().toISO(),timeMax:a.toUTC().toISO(),singleEvents:"true",orderBy:"startTime",maxResults:"2500"}),s=encodeURIComponent(i||"");return"https://www.googleapis.com/calendar/v3/calendars/"+s+"/events?"+n.toString()}({date:a,timezone:"America/Santiago"}),r=await fetch(e),s=await r.json().catch(()=>null);if(!r.ok||!s){let a=s?.error?.message||"Error obteniendo eventos del calendario.";return t.status(r.status).json({error:a,diagnosticInfo:{url:e}})}let d=(s.items||[]).filter(e=>!e.start?.date&&!e.end?.date).map(e=>({id:e.id,start:e.start?.dateTime||e.start?.date,end:e.end?.dateTime||e.end?.date,summary:e.summary||""}));return t.status(200).json({busy:d,mode:n,source:"google-calendar-api"})}catch(e){return console.error("Error en /api/slots (Google Calendar):",e),t.status(500).json({error:e.message||"Error interno obteniendo los horarios."})}}a()}catch(e){a(e)}})},7153:(e,t)=>{var r;Object.defineProperty(t,"x",{enumerable:!0,get:function(){return r}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(r||(r={}))},1802:(e,t,r)=>{e.exports=r(145)}};var t=require("../../webpack-api-runtime.js");t.C(e);var r=t(t.s=6171);module.exports=r})();