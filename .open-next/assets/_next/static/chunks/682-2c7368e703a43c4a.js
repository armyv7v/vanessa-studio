"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[682],{8682:function(e,t,s){s.d(t,{Z:function(){return p}});var n=s(5893),a=s(7294),r=s(7366),i=s(221);function l(e){let{date:t,openHour:s,closeHour:n,stepMinutes:a,durationMinutes:r,busy:i=[],tz:l="America/Santiago",allowOverflowEnd:o=!1}=e,[c,d,m]=t.split("-").map(Number),u=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return new Date(c,d-1,m,e,t,0,0)};u(0,0);let x=u(s,0),h=u(n,0),g=i.map(e=>({start:new Date(e.start),end:new Date(e.end)})),f=[],p=new Date(x),b=e=>{let t=new Date(e.getTime()+6e4*r);return o?e<h:t<=h};for(;b(p);){let e=new Date(p),t=new Date(e.getTime()+6e4*r),s=g.some(s=>e<s.end&&t>s.start);f.push({start:e.toISOString(),end:t.toISOString(),available:!s}),p=new Date(p.getTime()+6e4*a)}let y=new Date,v=y.getFullYear()===c&&y.getMonth()===d-1&&y.getDate()===m;return f.filter(e=>!v||new Date(e.start)>y)}function o(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],s=e.getDay(),n=Math.ceil(e.getDate()/7),a="";return 0===s?a="SUN"+n:6===s&&(a="SAT"+n),!t.includes(a)}let c="64693698ebab23975e6f5d11f9f3b170a6d11b9a19ebb459e1486314ee930ebf@group.calendar.google.com",d="AIzaSyDqIFZZGAK6xL9ST0gTkPUZL-jmd5lElbk",m="https://vanessa-nails-api.enderjpinar.workers.dev";async function u(e){let{timeMin:t,timeMax:s,useWorker:n=!0}=e;if(n&&m){let e=t.substring(0,10),s=new URL("".concat(m,"/api/slots"));s.searchParams.set("action","getBusySlots"),s.searchParams.set("date",e);let n=await fetch(s.toString());if(!n.ok){let e=await n.text();throw Error("Error en API Worker ".concat(n.status,": ").concat(e))}let a=await n.json();return{busy:a.busy||[],raw:a}}if(!c||!d)throw Error("Faltan NEXT_PUBLIC_GCAL_CALENDAR_ID o NEXT_PUBLIC_GCAL_API_KEY");let a=new URLSearchParams({key:d,timeMin:t,timeMax:s,singleEvents:"true",orderBy:"startTime",maxResults:"2500"}),r="https://www.googleapis.com/calendar/v3/calendars/".concat(encodeURIComponent(c),"/events?").concat(a.toString()),i=await fetch(r);if(!i.ok){let e=await i.text();throw Error("Google Calendar ".concat(i.status,": ").concat(e))}let l=await i.json();return{busy:(l.items||[]).map(e=>{var t,s,n,a;return{start:(null===(t=e.start)||void 0===t?void 0:t.dateTime)||((null===(s=e.start)||void 0===s?void 0:s.date)?"".concat(e.start.date,"T00:00:00Z"):null),end:(null===(n=e.end)||void 0===n?void 0:n.dateTime)||((null===(a=e.end)||void 0===a?void 0:a.date)?"".concat(e.end.date,"T23:59:59Z"):null)}}).filter(e=>e.start&&e.end),raw:l}}async function x(e){if(!e||!e.includes("@"))return null;try{let t=await fetch("/api/client?email=".concat(encodeURIComponent(e)));if(!t.ok)return null;return(await t.json()).client||null}catch(e){return console.error("Error al autocompletar datos del cliente:",e),null}}var h=s(8583);function g(e){let{service:t,date:s,time:a,client:l,isExtra:o}=e;return t&&s&&a&&l?(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)("h2",{className:"text-2xl font-bold text-green-600 mb-2",children:"\xa1Cita Confirmada!"}),(0,n.jsx)("p",{className:"text-gray-600 mb-6",children:"Recibir\xe1s un correo con los detalles de tu reserva."}),(0,n.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-md border border-gray-200 text-left",children:[(0,n.jsxs)("h3",{className:"font-semibold mb-3 text-lg text-gray-800",children:["Resumen de tu cita ",o&&"(EXTRA CUPO)",":"]}),(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsxs)("p",{className:"flex justify-between items-center",children:[(0,n.jsx)("span",{className:"font-medium text-gray-600",children:"Servicio:"}),(0,n.jsx)("span",{className:"text-gray-800 font-semibold text-right",children:t.name})]}),(0,n.jsxs)("p",{className:"flex justify-between items-center",children:[(0,n.jsx)("span",{className:"font-medium text-gray-600",children:"Fecha:"}),(0,n.jsx)("span",{className:"text-gray-800 font-semibold",children:(0,r.WU)(s,"d MMMM yyyy",{locale:i.es})})]}),(0,n.jsxs)("p",{className:"flex justify-between items-center",children:[(0,n.jsx)("span",{className:"font-medium text-gray-600",children:"Hora:"}),(0,n.jsx)("span",{className:"text-gray-800 font-semibold",children:a})]})]})]}),(0,n.jsx)("p",{className:"mt-4 text-sm text-gray-500",children:"Redirigiendo al inicio en unos segundos..."})]}):null}let f=[{id:1,name:"Retoque (Mantenimiento)",duration:120},{id:2,name:"Reconstrucci\xf3n U\xf1as Mordidas (Onicofag\xeda)",duration:180},{id:3,name:"U\xf1as Acr\xedlicas",duration:180},{id:4,name:"U\xf1as Polygel",duration:180},{id:5,name:"U\xf1as Softgel",duration:180},{id:6,name:"Kapping o Ba\xf1o Polygel o Acr\xedlico sobre u\xf1a natural",duration:150},{id:7,name:"Reforzamiento Nivelaci\xf3n Rubber",duration:150},{id:8,name:"Esmaltado Permanente",duration:90}].sort((e,t)=>e.duration-t.duration);function p(e){var t,s;let{config:c}=e,{isExtra:d,openHour:m,closeHour:p,allowOverflowEnd:b,daysToShow:y}=c,[v,j]=(0,a.useState)(""),[w,N]=(0,a.useState)(null),[k,S]=(0,a.useState)(""),[C,M]=(0,a.useState)({name:"",email:"",phone:""}),[E,D]=(0,a.useState)(1),[U,T]=(0,a.useState)([]),[P,R]=(0,a.useState)(!1),[W,A]=(0,a.useState)(null),[L,I]=(0,a.useState)(null),[O,_]=(0,a.useState)({width:void 0,height:void 0}),[H,B]=(0,a.useState)([]),{isFetchingClient:F,handleEmailBlur:Z}=function(e){let[t,s]=(0,a.useState)(!1);return{isFetchingClient:t,handleEmailBlur:(0,a.useCallback)(async t=>{let n=t.target.value;if(n&&n.includes("@"))try{s(!0);let t=await x(n);t&&e(e=>({...e,name:t.name||e.name,phone:t.phone||e.phone}))}finally{s(!1)}},[e])}}(M),q=Array.from({length:y}).map((e,t)=>{let s=new Date;return s.setDate(s.getDate()+t),s}),z=q.filter(e=>!o(e,H)).map(e=>(0,r.WU)(e,"yyyy-MM-dd"));w&&z.includes((0,r.WU)(w,"yyyy-MM-dd")),(0,a.useEffect)(()=>{function e(){_({width:window.innerWidth,height:window.innerHeight})}return window.addEventListener("resize",e),e(),()=>window.removeEventListener("resize",e)},[]),(0,a.useEffect)(()=>{(async function(){try{let e=await fetch("/api/gs-check?action=getConfig");if(!e.ok)throw Error("La API devolvi\xf3 un error ".concat(e.status));let t=await e.json();t&&t.disabledDays&&B(t.disabledDays)}catch(e){console.error("Error fetching disabled days config:",e)}})()},[]);let G=(0,a.useCallback)(async(e,t)=>{try{R(!0),A(null);let s=(0,r.WU)(e,"yyyy-MM-dd"),n=f.find(e=>String(e.id)===String(t));if(!n)throw Error("Servicio no encontrado.");let a=new Date("".concat(s,"T00:00:00")),i=new Date("".concat(s,"T23:59:59")),{busy:o}=await u({timeMin:a.toISOString(),timeMax:i.toISOString()}),c=p,x=b;if(!d){let e=new Date("".concat(s,"T18:00:00")).getTime();if(!o.some(t=>new Date(t.start).getTime()>=e)){let e=l({date:s,openHour:m,closeHour:p,stepMinutes:30,durationMinutes:n.duration,busy:o||[],allowOverflowEnd:!1}),t=e[e.length-1];t&&!t.available&&(c=21,x=!0)}}let h=l({date:s,openHour:m,closeHour:c,stepMinutes:30,durationMinutes:n.duration,busy:o||[],allowOverflowEnd:x}).filter(e=>e.available).map(e=>(0,r.WU)(new Date(e.start),"HH:mm"));T(h)}catch(e){A(String((null==e?void 0:e.message)||e)),T([])}finally{R(!1)}},[d,m,p,b]);(0,a.useEffect)(()=>{w&&v&&G(w,v)},[w,v,G]);let V=e=>{j(e),N(null),S(""),D(2)},X=e=>{N(e),S(""),D(3)},K=e=>{S(e),D(4)},Y=(e,t)=>{M(s=>({...s,[e]:t}))},J=async e=>{e.preventDefault();try{I({loading:!0});let e=f.find(e=>e.id===v),t={serviceId:v,serviceName:null==e?void 0:e.name,durationMin:null==e?void 0:e.duration,date:(0,r.WU)(w,"yyyy-MM-dd"),start:k,extraCupo:d,client:C},s=await fetch("/api/book",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}),n=await s.json();if(!s.ok||(null==n?void 0:n.error))throw Error((null==n?void 0:n.error)||"Error al confirmar la cita");I({success:!0,message:"\xa1Cita confirmada!"}),setTimeout(()=>{j(""),N(null),S(""),M({name:"",email:"",phone:""}),D(1),I(null)},3e3)}catch(e){I({error:!0,message:String(e.message||e)})}},Q=e=>e?(0,r.WU)(e,"d MMMM yyyy",{locale:i.es}):"";return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:"mb-8",children:[(0,n.jsx)("div",{className:"flex justify-center items-center mb-4",children:[1,2,3,4].map(e=>(0,n.jsxs)("div",{className:"flex items-center",children:[(0,n.jsx)("div",{className:"w-8 h-8 rounded-full flex items-center justify-center text-sm font-medium ".concat(E>=e?"bg-pink-600 text-white":"bg-gray-300 text-gray-600"),children:e}),e<4&&(0,n.jsx)("div",{className:"w-16 h-1 ".concat(E>e?"bg-pink-600":"bg-gray-300")})]},e))}),(0,n.jsxs)("div",{className:"flex justify-between max-w-xs mx-auto text-sm text-gray-600",children:[(0,n.jsx)("span",{className:"flex-1 text-center",children:"Servicio"}),(0,n.jsx)("span",{className:"flex-1 text-center",children:"Fecha"}),(0,n.jsx)("span",{className:"flex-1 text-center",children:"Hora"}),(0,n.jsx)("span",{className:"flex-1 text-center",children:"Datos"})]})]}),1===E&&(0,n.jsxs)("div",{className:"max-w-6xl mx-auto",children:[(0,n.jsx)("h2",{className:"text-3xl font-bold mb-8 text-center text-gray-800",children:"Selecciona tu servicio"}),(0,n.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6",children:f.map(e=>(0,n.jsxs)("div",{onClick:()=>V(e.id),className:"group relative bg-white rounded-2xl shadow-lg hover:shadow-xl transition-all duration-300 cursor-pointer border border-gray-100 overflow-hidden transform hover:-translate-y-1 hover:scale-105 h-full flex flex-col",children:[(0,n.jsxs)("div",{className:"p-6 flex flex-col h-full",children:[(0,n.jsxs)("div",{className:"flex justify-between items-start mb-4",children:[(0,n.jsx)("div",{className:"w-10 h-10 bg-pink-100 rounded-lg flex items-center justify-center group-hover:bg-pink-200 transition-colors flex-shrink-0",children:(0,n.jsx)("svg",{className:"w-5 h-5 text-pink-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})})}),(0,n.jsxs)("div",{className:"bg-pink-100 text-pink-800 text-xs font-bold px-2 py-1 rounded-full",children:[e.duration," min"]})]}),(0,n.jsx)("h3",{className:"text-lg font-bold text-gray-800 mb-4 group-hover:text-pink-600 transition-colors flex-1",children:e.name}),(0,n.jsxs)("button",{className:"mt-auto w-full bg-gradient-to-r from-pink-500 to-purple-600 hover:from-pink-600 hover:to-purple-700 text-white font-semibold py-3 px-4 rounded-lg transition-all duration-300 transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-pink-500 focus:ring-opacity-50 shadow-md hover:shadow-lg flex items-center justify-center",children:["Seleccionar",(0,n.jsx)("svg",{className:"inline-block w-4 h-4 ml-2 transform group-hover:translate-x-1 transition-transform",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M14 5l7 7m0 0l-7 7m7-7H3"})})]})]}),(0,n.jsx)("div",{className:"absolute inset-0 bg-gradient-to-br from-pink-500/5 to-purple-600/5 opacity-0 group-hover:opacity-100 transition-opacity duration-300 pointer-events-none"})]},e.id))})]}),2===E&&(0,n.jsxs)("div",{className:"max-w-4xl mx-auto",children:[(0,n.jsxs)("h2",{className:"text-2xl font-semibold mb-6 text-center",children:["Selecciona una fecha para ",null===(t=f.find(e=>e.id===v))||void 0===t?void 0:t.name]}),(0,n.jsx)("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-5 gap-3",children:q.map((e,t)=>{let s=(0,r.WU)(e,"yyyy-MM-dd"),a=new Date;a.setHours(0,0,0,0);let l=s===(0,r.WU)(a,"yyyy-MM-dd"),c=e<a,d=o(e,H),m=c||!d;return(0,n.jsxs)("button",{onClick:()=>!m&&X(e),disabled:m,className:"p-3 rounded-lg border transition-all focus:outline-none focus:ring-2 focus:ring-pink-500 focus:ring-opacity-50 ".concat(w&&(0,r.WU)(w,"yyyy-MM-dd")===s?"bg-pink-600 text-white border-pink-600 transform scale-105":m?"bg-gray-100 text-gray-400 border-gray-200 cursor-not-allowed":"bg-white text-gray-800 border-gray-200 hover:border-pink-300 hover:shadow-sm"),children:[(0,n.jsx)("div",{className:"font-medium",children:l?"Hoy":(0,r.WU)(e,"EEE",{locale:i.es})}),(0,n.jsx)("div",{className:"text-lg font-bold",children:(0,r.WU)(e,"d")}),(0,n.jsx)("div",{className:"text-xs",children:(0,r.WU)(e,"MMM",{locale:i.es})})]},t)})}),(0,n.jsx)("div",{className:"mt-6 text-center",children:(0,n.jsx)("button",{onClick:()=>D(1),className:"px-4 py-2 text-pink-600 hover:text-pink-800 transition-colors",children:"← Volver a servicios"})})]}),3===E&&(0,n.jsxs)("div",{className:"max-w-2xl mx-auto",children:[(0,n.jsxs)("h2",{className:"text-2xl font-semibold mb-6 text-center",children:["Selecciona un horario para el ",Q(w)]}),W&&(0,n.jsxs)("div",{className:"mb-6 p-4 bg-red-100 border border-red-400 text-red-700 rounded-lg",role:"alert",children:[(0,n.jsxs)("p",{children:[(0,n.jsx)("strong",{children:"Error:"})," ",W]}),(0,n.jsx)("p",{className:"text-sm mt-2",children:"Por favor, verifica tu conexi\xf3n e int\xe9ntalo nuevamente."})]}),w&&(0,n.jsxs)("div",{className:"mt-6",children:[(0,n.jsxs)("h2",{className:"text-xl font-semibold mb-4",children:["Horarios disponibles - ",Q(w)]}),P?(0,n.jsxs)("div",{className:"text-center py-8",children:[(0,n.jsx)("p",{className:"text-gray-600 mb-4",children:"Cargando horarios disponibles..."}),(0,n.jsx)("div",{className:"flex justify-center",children:(0,n.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-pink-600"})})]}):U&&U.length>0?(0,n.jsx)("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-2",children:U.map(e=>(0,n.jsx)("button",{onClick:()=>K(e),className:"p-3 rounded-lg transition-all focus:outline-none focus:ring-2 focus:ring-pink-500 focus:ring-opacity-50 ".concat(k===e?"bg-pink-600 text-white transform scale-105":"bg-white border border-gray-200 hover:border-pink-300 hover:shadow-sm"),children:e},e))}):(0,n.jsxs)("div",{className:"text-center py-8",children:[(0,n.jsx)("p",{className:"text-gray-600 mb-4",children:"No hay horarios disponibles para este d\xeda. Elige otro d\xeda."}),(0,n.jsx)("button",{onClick:()=>D(2),className:"px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors",children:"← Volver a fechas"})]})]}),(0,n.jsxs)("div",{className:"mt-8 flex justify-between",children:[(0,n.jsx)("button",{onClick:()=>D(2),className:"px-4 py-2 text-pink-600 hover:text-pink-800 transition-colors",children:"← Volver a fechas"}),k&&(0,n.jsx)("button",{onClick:()=>D(4),className:"px-6 py-2 bg-pink-600 text-white rounded-lg hover:bg-pink-700 transition-colors focus:outline-none focus:ring-2 focus:ring-pink-500 focus:ring-opacity-50",children:"Continuar"})]})]}),4===E&&((null==L?void 0:L.success)?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(h.Z,{width:O.width,height:O.height,recycle:!1,numberOfPieces:500,tweenDuration:1e4}),(0,n.jsx)(g,{service:f.find(e=>e.id===v),date:w,time:k,client:C,isExtra:d})]}):(0,n.jsxs)("div",{className:"max-w-md mx-auto",children:[(0,n.jsx)("h2",{className:"text-2xl font-semibold mb-6 text-center",children:"Tus datos"}),(0,n.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-md mb-6 border border-gray-200",children:[(0,n.jsxs)("h3",{className:"font-semibold mb-3 text-lg",children:["Resumen de tu cita",d&&" (EXTRA CUPO)",":"]}),(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsxs)("p",{className:"flex justify-between",children:[(0,n.jsx)("span",{className:"font-medium",children:"Servicio:"}),(0,n.jsx)("span",{children:null===(s=f.find(e=>e.id===v))||void 0===s?void 0:s.name})]}),(0,n.jsxs)("p",{className:"flex justify-between",children:[(0,n.jsx)("span",{className:"font-medium",children:"Fecha:"}),(0,n.jsx)("span",{children:Q(w)})]}),(0,n.jsxs)("p",{className:"flex justify-between",children:[(0,n.jsx)("span",{className:"font-medium",children:"Hora:"}),(0,n.jsx)("span",{children:k})]})]})]}),(0,n.jsxs)("form",{onSubmit:J,className:"space-y-4",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nombre completo *"}),(0,n.jsx)("input",{type:"text",required:!0,value:C.name,onChange:e=>Y("name",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-pink-500 focus:border-transparent transition-colors",placeholder:"Tu nombre completo"})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email *"}),(0,n.jsxs)("div",{className:"relative",children:[(0,n.jsx)("input",{type:"email",required:!0,value:C.email,onChange:e=>Y("email",e.target.value),onBlur:Z,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-pink-500 focus:border-transparent transition-colors",placeholder:"tu@email.com"}),F&&(0,n.jsx)("div",{className:"absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none",children:(0,n.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-pink-600"})})]})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Tel\xe9fono *"}),(0,n.jsx)("input",{type:"tel",required:!0,value:C.phone,onChange:e=>Y("phone",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-pink-500 focus:border-transparent transition-colors",placeholder:"+56 9 1234 5678"})]}),L&&(0,n.jsxs)("div",{className:"mt-4 p-4 rounded-lg ".concat(L.loading?"bg-blue-100 text-blue-800":L.success?"bg-green-100 text-green-800":L.error?"bg-red-100 text-red-800":""),children:[L.loading&&(0,n.jsxs)("div",{className:"flex items-center",children:[(0,n.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-current mr-2"}),(0,n.jsx)("span",{children:"Confirmando cita..."})]}),L.success&&(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{className:"font-semibold",children:L.message}),(0,n.jsx)("p",{className:"text-sm mt-1",children:"Revisa tu correo para el detalle."})]}),L.error&&(0,n.jsxs)("div",{children:[(0,n.jsxs)("p",{className:"font-semibold",children:["Error: ",L.message]}),(0,n.jsx)("p",{className:"text-sm mt-1",children:"Por favor, int\xe9ntalo nuevamente."})]})]}),(0,n.jsxs)("div",{className:"mt-8 flex flex-col sm:flex-row justify-between gap-4",children:[(0,n.jsx)("button",{type:"button",onClick:()=>D(3),className:"px-4 py-2 text-pink-600 hover:text-pink-800 transition-colors",children:"← Volver a horarios"}),(0,n.jsx)("button",{type:"submit",disabled:null==L?void 0:L.loading,className:"px-6 py-2 bg-pink-600 text-white rounded-lg hover:bg-pink-700 disabled:opacity-50 transition-colors focus:outline-none focus:ring-2 focus:ring-pink-500 focus:ring-opacity-50",children:(null==L?void 0:L.loading)?"Confirmando...":"Confirmar Cita"})]})]})]}))]})}}}]);